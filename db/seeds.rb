# Мини базы данных
@post_titles = [
  "Современный минимализм для гостиной",
  "Эко-дизайн: Натуральные материалы в интерьере",
  "Скандинавский стиль: Простота и уют",
  "Идеи для уютного уголка на балконе",
  "Тренды 2024: Модные оттенки в интерьере",
  "Как выбрать идеальный диван для гостиной",
  "Комбинация текстур: Советы по выбору тканей",
  "Декор из натурального дерева",
  "Освещение в интерьере: Как создать атмосферу",
  "Лофт-дизайн: Индустриальный стиль для квартиры",
  "Маленькая кухня: Функциональные решения",
  "Спальня в стиле бохо: Яркие акценты и текстиль",
  "Идеи для домашнего офиса в современном стиле",
  "Как создать гармонию в интерьере с растениями",
  "Топ-5 предметов мебели для маленьких квартир",
  "Идеи зонирования пространства в студии",
  "Декор в пастельных тонах: Уют и спокойствие",
  "Мрамор в интерьере: Элегантность и роскошь",
  "Оформление ванной комнаты в эко-стиле",
  "Как выбрать кресло для рабочего места",
  "Стильная прихожая: Встречаем гостей с комфортом",
  "Небольшая спальня: Оптимальные решения для хранения",
  "Как организовать пространство детской комнаты",
  "Секреты идеального освещения для спальни",
  "Черно-белый интерьер: Классика, проверенная временем",
  "Текстиль в интерьере: Как выбрать шторы и подушки",
  "Создаем уютную гостиную для всей семьи",
  "Японский минимализм: Эстетика простоты",
  "Как оформить интерьер в стиле mid-century",
  "Использование металла в интерьере: Современные тренды"
]

@items = [
  "Диван с мягкой обивкой",
  "Кофейный столик из натурального дерева",
  "Кресло в стиле ретро",
  "Стеллаж для книг из металла",
  "Настенный светильник в индустриальном стиле",
  "Ковер с геометрическим узором",
  "Шторы из льна",
  "Кушетка с яркими подушками",
  "Тумба для обуви",
  "Декоративные подушки с цветочным принтом",
  "Зеркало в рамке из массива",
  "Обеденный стол из стекла",
  "Стул с мягкой спинкой",
  "Торшер с регулируемой высотой",
  "Комод с множеством ящиков",
  "Ванная раковина с оригинальным дизайном",
  "Кухонный остров с барными стульями",
  "Текстиль для ванной: полотенца и коврики",
  "Настенная картина в современном стиле",
  "Декоративные фигурки из керамики",
  "Подвесная люстра в стиле минимализма",
  "Садовая мебель для террасы",
  "Полка для вещей с крючками",
  "Лампа с USB-портом",
  "Мягкий пуф для отдыха",
  "Каминные принадлежности",
  "Подвесной стеллаж для растений",
  "Встраиваемая техника для кухни",
  "Декор для стен: панно и наклейки"
]

@images = [
  "https://i.pinimg.com/564x/df/05/52/df0552bec88aed7f1caf74258e752c33.jpg",
  "https://i.pinimg.com/736x/4f/2b/55/4f2b5564500da68dc257b92f464cf683.jpg",
  "https://i.pinimg.com/736x/a3/13/c1/a313c1992b0066ed0e11ddfa5e645f2c.jpg",
  "https://i.pinimg.com/736x/92/2c/39/922c39f86c776bca63a987d41053b5ce.jpg",
  "https://i.pinimg.com/564x/e1/14/da/e114da44c775e7474eceec57f7924187.jpg",
  "https://i.pinimg.com/564x/a0/ce/71/a0ce7148cbf9a284eea258416122839d.jpg",
  "https://i.pinimg.com/564x/e8/cb/c4/e8cbc4e78b9136261dcd7c02f2169dbf.jpg",
  "https://i.pinimg.com/736x/4c/29/e3/4c29e354b211b40489461905e44b1f15.jpg",
  "https://i.pinimg.com/736x/c5/43/2f/c5432f2e9df72f4d58a5cd4ce18ac1d5.jpg",
  "https://i.pinimg.com/564x/35/2a/a6/352aa67dade28327272fafa66aa5b5f8.jpg",
  "https://i.pinimg.com/564x/c8/ff/60/c8ff60a6c5ec969ef00dfbfcb68ab4e0.jpg",
  "https://i.pinimg.com/736x/49/91/81/49918185608fd74c30e31dd6b329c134.jpg",
  "https://i.pinimg.com/736x/e5/1c/b0/e51cb04e2ebedcb609bf79b02b29c434.jpg",
  "https://i.pinimg.com/564x/7f/ed/e2/7fede24ee8742114fb6027179ed9f388.jpg",
  "https://i.pinimg.com/736x/fe/e5/21/fee521091fc56b14b292a320cd3db842.jpg",
  "https://i.pinimg.com/564x/e3/af/87/e3af8701bae79b212dfa7cd8eb3ba52e.jpg",
  "https://i.pinimg.com/564x/74/8e/88/748e88a5da974c817d4c257b4b516fac.jpg",
  "https://i.pinimg.com/736x/aa/c5/51/aac551747fd4b465d4ff30bd896e7ea9.jpg",
  "https://i.pinimg.com/564x/25/21/ea/2521ea09e14729e15649341d2963d976.jpg",
  "https://i.pinimg.com/564x/fa/cf/07/facf07eaaa763f1d2cdc03fe7e958b5a.jpg",
  "https://i.pinimg.com/564x/61/06/27/61062728542f522bbf0585038c464489.jpg",
  "https://i.pinimg.com/736x/31/f9/ae/31f9aec00bc38cd3cab160d929eb913d.jpg",
  "https://i.pinimg.com/474x/0d/8d/71/0d8d71298e716d2ac1b264486c8dada4.jpg",
  "https://i.pinimg.com/474x/c1/68/f9/c168f93a02537c7bfb0f9c365f4afe39.jpg",
  "https://i.pinimg.com/474x/61/3c/89/613c89707440777c5f60f06ea15163fe.jpg",
  "https://i.pinimg.com/474x/fe/b2/fd/feb2fd924531ce2ef601ccc45ad3e264.jpg"
]

@descriptions = [
  "Этот интерьер подчеркивает идею минимализма, где каждый элемент выбран с вниманием к деталям и функциональности.",
  "Натуральные материалы в сочетании с эко-дизайном создают уют и гармонию в пространстве.",
  "Скандинавский стиль предлагает простоту и легкость, делая комнату светлой и просторной.",
  "Небольшие пространства, такие как балкон, могут быть стильными и функциональными с правильными аксессуарами.",
  "В этом интерьере использованы актуальные оттенки 2024 года, которые придают помещению свежий и модный вид.",
  "Правильный выбор дивана может сделать гостиную центром комфорта и отдыха для всей семьи.",
  "Комбинация различных текстур добавляет глубину и индивидуальность любому интерьеру.",
  "Декор из натурального дерева придает интерьеру теплоту и естественность.",
  "Освещение играет ключевую роль в создании атмосферы, добавляя комнате уют или динамичность.",
  "Индустриальный стиль с элементами лофта привносит в интерьер дух урбанистики и современности.",
  "Даже маленькая кухня может быть стильной и функциональной, если грамотно использовать пространство.",
  "Яркие акценты и текстиль создают неповторимую атмосферу в спальне в стиле бохо.",
  "Домашний офис может быть функциональным и стильным, если следовать современным дизайнерским решениям.",
  "Комнатные растения не только украшают интерьер, но и улучшают атмосферу, делая ее более свежей и живой.",
  "Для небольших квартир важно подбирать компактные и многофункциональные предметы мебели.",
  "Зонирование пространства в студии позволяет использовать его максимально эффективно.",
  "Пастельные тона создают в интерьере спокойную и уютную атмосферу.",
  "Мраморные элементы добавляют в интерьер нотки роскоши и элегантности.",
  "Эко-стиль в ванной комнате — это сочетание природы и комфорта, создающее расслабляющую атмосферу.",
  "Выбор правильного кресла для рабочего места — залог комфорта и продуктивности."
]
@prices = (100..1000).step(50).to_a

@names = [
  "Marg.o",
  "Allise Alov",
  "ALex’x",
  "Elliot",
  "Lisa",
  "Maxim",
  "Ira",
  "Alla",
  "Artur",
  "Nanna"
]
@usernames = [
  "@margo_sha",
  "@alllllise.e",
  "@alex.00",
  "@elloittt",
  "@etolisa",
  "@avimax",
  "@irinna",
  "@alllla",
  "@archii",
  "@niekka"
]
@avatars = [
  "https://i.pinimg.com/564x/8c/e8/0e/8ce80e14454b7cc5c02ca86142ccc068.jpg",
  "https://i.pinimg.com/564x/ed/83/e4/ed83e4d62272b0e7e0f7974eb06745fc.jpg",
  "https://i.pinimg.com/564x/d9/ac/21/d9ac2106f378795f242495f1873f23d7.jpg",
  "https://i.pinimg.com/564x/c3/a3/df/c3a3df45a235d1432e11176c48e7b50c.jpg",
  "https://i.pinimg.com/564x/21/3c/82/213c8294633b4748ab0f6190504edb0d.jpg",
  "https://i.pinimg.com/564x/50/4b/78/504b78685218279a238d6ae1521e4cf1.jpg",
  "https://i.pinimg.com/736x/7c/74/27/7c7427064248feda457dd1ed095fb7de.jpg",
  "https://i.pinimg.com/474x/5c/db/89/5cdb89bdaae54c994f03a0441dd5bc8a.jpg",
  "https://i.pinimg.com/474x/05/e9/b2/05e9b2a67b288376c4cfcb22d41bd1a1.jpg",
  "https://i.pinimg.com/736x/8a/b2/45/8ab245c8af42de3fad3cf9a7fd5f393c.jpg"
]

@markets = [
  "https://248006.selcdn.ru/main/iblock/126/1264f92977737cb2a77847cc516fba77/fcb6b9db9510c54f2663af70f561f2ab.jpg",
  "https://wylsa.com/wp-content/uploads/2022/04/1119-3.jpg",
  "https://avatars.mds.yandex.net/get-mpic/1602935/img_id5809334395720083934.jpeg/orig",
  "https://ae01.alicdn.com/kf/HTB18eCBQXXXXXXfXXXX760XFXXXa.png",
  "https://avatars.mds.yandex.net/i?id=26f8f20ddb4742b97c0376774bd5bad5fc1ade6d-9813974-images-thumbs&n=13",
  "https://www.dimelo.com/wp-content/uploads/inline-images/leroymerlin.png"
]

@item_images = [
  "https://i.pinimg.com/474x/75/80/d1/7580d1b7a74b5151f88bbb48e8225208.jpg",
  "https://i.pinimg.com/474x/c7/90/17/c790171dab2da294bb7a83096bd93f8f.jpg",
  "https://i.pinimg.com/474x/ed/c7/ef/edc7efeae3f1684f3b627af0dc033092.jpg",
  "https://i.pinimg.com/474x/b2/43/ca/b243cab9a865588233ad60e94fe5d7bb.jpg",
  "https://i.pinimg.com/474x/15/9d/26/159d261b42682023315c2be70a3e2435.jpg",
  "https://i.pinimg.com/474x/37/d1/24/37d1245dfccc6fcf21c8312245d60003.jpg",
  "https://i.pinimg.com/474x/cb/f6/22/cbf6225993db733928f5e92e5cfcce35.jpg",
  "https://i.pinimg.com/474x/27/d9/9a/27d99a4ebf5fa67141947a09cc139c83.jpg",
  "https://i.pinimg.com/474x/a2/10/e4/a210e4f23d9b97dd01d5d35563bc6573.jpg",
  "https://i.pinimg.com/474x/1d/e3/ae/1de3aee497eaa1ab38cc982ffb885881.jpg",
  "https://i.pinimg.com/474x/bf/bc/7a/bfbc7aa73a4a5287f3aad0fb8bd8d40d.jpg",
  "https://i.pinimg.com/474x/0d/7e/75/0d7e75f20603e59cf572d30d003b11f0.jpg",
  "https://i.pinimg.com/474x/29/f5/2c/29f52cd9a38f5bc19b803ce30c6941a4.jpg",
  "https://i.pinimg.com/474x/d4/37/87/d4378708e4b9f2634e9d11e277d1c718.jpg",
  "https://i.pinimg.com/564x/fe/90/d0/fe90d0591318521cf07e1b10387ef8c9.jpg",
  "https://i.pinimg.com/564x/37/44/6e/37446e697e47d3f81dc345d3635fcde2.jpg",
  "https://i.pinimg.com/474x/48/fb/a3/48fba3fdad7e8ea382924e0883bde370.jpg",
  "https://i.pinimg.com/474x/c8/c1/92/c8c19230aaee79bc451f3f206117b7f4.jpg"
]

@raw_text = 'Дом Наркомфина — один из знаковых памятников архитектуры советского авангарда и конструктивизма. Построен в 1928—1930 годах по проекту архитекторов Моисея Гинзбурга, Игнатия Милиниса и инженера Сергея Прохорова для работников Народного комиссариата финансов СССР (Наркомфина). Автор замысла дома Наркомфина Гинзбург определял его как «опытный дом переходного типа». Дом находится в Москве по адресу: Новинский бульвар, дом 25, корпус 1. С начала 1990-х годов дом находился в аварийном состоянии, был трижды включён в список «100 главных зданий мира, которым грозит уничтожение». В 2017—2020 годах отреставрирован по проекту АБ «Гинзбург Архитектс», функционирует как элитный жилой дом. Отдельно стоящий «Коммунальный блок» (историческое название) планируется как место проведения публичных мероприятий.'
@words = @raw_text.downcase.gsub(/[—.—,«»:()]/, '').gsub(/  /, ' ').split(' ')

# Генератор 
def seed
  reset_db
  create_users(10)
  create_profiles
  create_posts(100)
  create_items(3..10)
  create_comments(2..8)
  3.times do
    create_comment_replies
  end
end

# Обновление баз данных
def reset_db
  Rake::Task['db:drop'].invoke
  Rake::Task['db:create'].invoke
  Rake::Task['db:migrate'].invoke
end

# Получает рандомные значения True/False
def get_random_bool
  [true, false].sample
end

def create_sentence
  sentence_words = []
  (10..20).to_a.sample.times do
    sentence_words << @words.sample
  end
  sentence_words.join(' ').capitalize + '.'
end

# Создание пользователей
def create_users(quantity)
  quantity.times do |i|
    user_data = {
      email: "user_#{i}@email.com",
      password: 'testtest'
    }
    user_data[:admin] = true if i == 0
    user = User.create!(user_data)
    puts "User created with id #{user.id}"
  end
end

# Создание профилей
def create_profiles
  User.all.each_with_index do |user, index|
    profile_data = {
      username: @usernames[index] || "user_#{index + 1}",
      avatar_url: @avatars[index] || "default_avatar_url",
      name: @names[index] || "User #{index + 1}"
    }

    if user.profile.present?
      user.profile.update!(profile_data)
      puts "Profile updated for user with id #{user.id}"
    else
      user.create_profile!(profile_data)
      puts "Profile created for user with id #{user.id}"
    end
  end
end

# Создание постов
def create_posts(quantity)
  quantity.times do
    profile = Profile.all.sample
    post = profile.posts.create!(
      title: @post_titles.sample,
      image_url: @images.sample,
      description: @descriptions.sample,
      public: get_random_bool
    )
    puts "Post with title #{post.title} just created for profile #{profile.id}"
  end
end

# Создание товаров
def create_items(quantity)
  Post.all.each do |post|
    quantity.to_a.sample.times do
      begin
        user = User.all.sample
        profile = user.profile
        item_data = {
          name: @items.sample,
          price: @prices.sample,
          profile: profile,
          market_icon_url: @markets.sample,
          image_url: @item_images.sample
        }
        puts "Creating item: #{item_data.inspect}"
        post.items.create!(item_data)
      rescue ActiveRecord::RecordInvalid => e
        puts "Error creating item: #{e.record.errors.full_messages.join(", ")}"
      end
    end
  end
end

# Создание комментариев
def create_comments(quantity)
  Post.all.each do |post|
    quantity.to_a.sample.times do
      begin
        profile = Profile.all.sample # Получаем случайный профиль
        comment = Comment.create!(
          post: post,
          profile: profile, # Привязываем комментарий к профилю
          body: create_sentence
        )
        puts "Comment with id #{comment.id} for post with id #{comment.post.id} just created by profile #{profile.id}"
      rescue ActiveRecord::RecordInvalid => e
        puts "Error creating comment: #{e.record.errors.full_messages.join(", ")}"
      end
    end
  end
end

# Создание ответов на комментарии
def create_comment_replies
  Comment.all.each do |comment|
    if rand(1..3) == 1
      begin
        profile = Profile.all.sample # Получаем случайный профиль
        comment_reply = Comment.create!(
          post: comment.post,       # Указываем пост, к которому относится комментарий
          profile: profile,         # Привязываем ответ к профилю
          comment: comment,         # Указываем родительский комментарий
          body: create_sentence
        )
        puts "Comment reply with id #{comment_reply.id} for comment with id #{comment.id} just created"
      rescue ActiveRecord::RecordInvalid => e
        puts "Error creating comment reply: #{e.record.errors.full_messages.join(", ")}"
      end
    end
  end
end

seed

